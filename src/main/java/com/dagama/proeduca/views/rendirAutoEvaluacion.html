<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/bootstrap-select.css" rel="stylesheet">
    <!-- font awesome for icons -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <!-- flex slider css -->
    <link href="assets/css/flexslider.css" rel="stylesheet" type="text/css" media="screen">
    <!-- animated css  -->
    <link href="assets/css/animate.css" rel="stylesheet" type="text/css" media="screen">
    <!-- Revolution Style-sheet -->
    <link href="assets/rs-plugin/css/settings.css" rel="stylesheet" type="text/css">
    <link href="assets/css/rev-style.css" rel="stylesheet" type="text/css">
    <!--owl carousel css-->
    <link href="assets/owl-carousel/dist/assets/owl.carousel.css" rel="stylesheet" type="text/css" media="screen">
    <link href="assets/owl-carousel/dist/assets/owl.theme.default.css" rel="stylesheet" type="text/css" media="screen">
    <!--mega menu -->
    <link href="assets/css/yamm.css" rel="stylesheet" type="text/css">
    <!--cube css-->
    <link href="assets/cubeportfolio/css/cubeportfolio.min.css" rel="stylesheet" type="text/css">
    <!-- custom css-->
    <link href="assets/css/components.css" rel="stylesheet" type="text/css" media="screen">
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" media="screen">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div id="cabeceraMenu">

</div>
<br>
    <section class="container">
        <br>
        <div class="container">
            <div class="form-group col-md-12">
                <h4 class="my-4">Autoevaluación</h4>
            </div>
        </div>
    </section>
<section class="container">
    <input type="hidden" id="nivelUsuario">
    <div class="form-group col-md-8">
        <section class="container">
            <div class="form-group col-md-4">
                <label for="idusuario">Alumno: </label>
                <input type="hidden" id="idusuario">
                <input type='text' class="form-control" id="txtUsuario" disabled="disabled" />
            </div>
        </section>
        <section class="container">
            <div class="form-group col-md-4">
                <label for="idNivel">Nivel: </label>
                <select class="form-control" id="idNivel" required="required">
                </select>
            </div>
        </section>
        <section class="container">
            <div class="form-group col-md-4">
                <label>Dificultad: </label>
                <div>
                <input type="radio" name="idDificultad" value="F"/> Fácil
                </div>
                <div>
                    <input type="radio" name="idDificultad" value="N"/> Normal
                </div>
                <div>
                    <input type="radio" name="idDificultad" value="D"/> Difícil
                </div>
                <div>
                    <input type="radio" name="idDificultad" value="A"/> Avanzado
                </div>
            </div>
        </section>
        <section class="container">
            <div class="form-group col-md-4">
                <label for="idEvaluacion">Evaluacion: </label>
                <select class="form-control" id="idEvaluacion" required="required">
                </select>
            </div>
        </section>
        <section class="container">
            <div class="form-row">
                <div class="form-group col-md-4">
                    <button id="btnRendirAutoEvaluacion" class="btn btn-primary" >Rendir Autoevaluación</button>
                </div>
            </div>
        </section>
    </div>
</section>
 <div id="Footer">

 </div>

<script src="assets/js/jquery.min.js "></script>
<script src="assets/js/jquery-migrate.min.js "></script>
<!--bootstrap js plugin-->
<script src="assets/js/bootstrap.min.js " type="text/javascript "></script>
<!--easing plugin for smooth scroll-->
<script src="assets/js/jquery.easing.1.3.min.js " type="text/javascript "></script>
<!--sticky header-->
<script type="text/javascript " src="assets/js/jquery.sticky.js "></script>
<!--flex slider plugin-->
<script src="assets/js/jquery.flexslider-min.js " type="text/javascript "></script>
<!--parallax background plugin-->
<script src="assets/js/jquery.stellar.min.js " type="text/javascript "></script>
<!--digit countdown plugin-->
<script src="assets/js/waypoints.min.js "></script>
<!--digit countdown plugin-->
<script src="assets/js/jquery.counterup.min.js " type="text/javascript "></script>
<!--on scroll animation-->
<script src="assets/js/wow.min.js " type="text/javascript "></script>
<!--owl carousel slider-->
<script src="assets/owl-carousel/dist/owl.carousel.min.js " type="text/javascript "></script>
<!--popup js-->
<script src="assets/js/jquery.magnific-popup.min.js " type="text/javascript "></script>
<!--customizable plugin edit according to your needs-->
<script src="assets/js/custom.js " type="text/javascript "></script>
<script type="text/javascript " src="assets/rs-plugin/js/jquery.themepunch.tools.min.js "></script>
<script type="text/javascript " src="assets/rs-plugin/js/jquery.themepunch.revolution.min.js "></script>
<script type="text/javascript " src="assets/rs-plugin/videojs/video.js "></script>
<script type="text/javascript " src="assets/js/revolution-custom.js "></script>
<script src="assets/js/bootstrap-select.min.js " type="text/javascript "></script>
<script src="assets/js/jquery-ui.min.js " type="text/javascript "></script>
<script src="assets/cubeportfolio/js/jquery.cubeportfolio.min.js " type="text/javascript "></script>
<script src="assets/js/cube-portfolio.js " type="text/javascript "></script>
<script src="assets/js/pace.min.js " type="text/javascript "></script>

<script>
      $("#cabeceraMenu").load('cabeceraMenu.html');
      $("#Footer").load('Footer.html');

      var idusuario = sessionStorage.getItem("idusuario");
      var idtipo = sessionStorage.getItem("idtipo");
      var nombrealumno = sessionStorage.getItem("nombrealumno");

       if(nombrealumno == "" || nombrealumno == null || nombrealumno == undefined ||
       idtipo == "" || idtipo == null || idtipo == undefined ||
       nombrealumno == "" || nombrealumno == null || nombrealumno == undefined)
       {
           window.location.href = "login.html";
       }
       else{
          $("#idusuario").val(idusuario);
          $("#txtUsuario").val(nombrealumno);
          MostrarNivelUsuario($("#idusuario").val());
          LLenarEvaluacionPorUsuario();
      }



      $("input[type=radio][name=idDificultad]").change(function() {
        LLenarEvaluacionPorUsuario();
      });

 $( "#btnRendirAutoEvaluacion" ).click(function()
 {
     if($('input[type=radio][name=idDificultad]:checked').val() == undefined)
     {
        alert("Debe seleccionar una dificultad")
        return false;
     }

     var dificultad = $('input[type=radio][name=idDificultad]:checked').val();
     var ExisteEvaluacion = false;
     var idevaluacionSelected = $("#idEvaluacion").val();
     var nombreNivelSelected = document.getElementById("idNivel").options[document.getElementById("idNivel").selectedIndex].text;

     $.get( "http://localhost:8080/api/autoevaluacionxusuario/" + $("#idusuario").val() + "/" + dificultad, function(data)
     {
         for(var i=0; i<data.length; i++)
         {
            if(data[i].idevaluacion == idevaluacionSelected && data[i].nombrenivelestudio == nombreNivelSelected)
            {
                ExisteEvaluacion = true;
                duracionEvaluacion = data[i].duracion;
                break;
            }
         }

          if(ExisteEvaluacion == true)
          {
              var comboEvaluacion = $("#idEvaluacion").val();
              var nombreComboEvaluacion = $("#idEvaluacion option:selected").text();

              var comboNivel =  $("#idNivel").val();
              var nombreComboNivel = $("#idNivel option:selected").text();

              var comboUsuario =  $("#idusuario").val();
              var nombrecomboUsuario = $("#txtUsuario").val();

              localStorage.setItem("idusuario", comboUsuario);
              localStorage.setItem("nombreUsuario", nombrecomboUsuario);

              localStorage.setItem("idEvaluacion", comboEvaluacion);
              localStorage.setItem("nombreEvaluacion", nombreComboEvaluacion);

              localStorage.setItem("duracion", duracionEvaluacion);
              localStorage.setItem("dificultad", dificultad);

              localStorage.setItem("idnivel", comboNivel);
              localStorage.setItem("nombrenivel", nombreComboNivel);

              window.location.href = 'AutoEvaluacion.html';
          }
          else
          {
             window.location.href = 'rendirAutoEvaluacion.html';
          }
     });
 });

 function MostrarNivelUsuario(idusuario)
 {
    $.get( "http://localhost:8080/api/usuario/1", function(data){
         for(var i = 0; i<data.length; i++)
         {
            if(data[i].idusuario== idusuario)
            {
               $("#nivelUsuario").val(data[i].idnivelestudio)
               MostrarComboNivelUsuario(data[i].idnivelestudio)
            }
         }
   });
 }

 function MostrarComboNivelUsuario(idnivelEstudio)
 {
         //llenar niveles de estudio
         $("#idNivel").html('');
         $.get( "http://localhost:8080/api/nivelestudio/" + idnivelEstudio, function(data){
          var x = "[" + JSON.stringify(data) + "]";
          var z = (JSON.parse(x))
          $.each( z, function(index, value){
                $("#idNivel").append($('<option>', {
                     value: value.idnivelestudio,
                     text: value.nombrenivelestudio
                 }));

             });
             }).fail(function( data ){
                 alert("Error");
    });
 }
 function LLenarEvaluacionPorUsuario()
 {
     if($('input[type=radio][name=idDificultad]:checked').val() == undefined)
     {
     }
     else
     {
          var dificultad = $('input[type=radio][name=idDificultad]:checked').val();
          $("#idEvaluacion").html('');

          $.get( "http://localhost:8080/api/autoevaluacionxusuario/" + $("#idusuario").val() + "/" + dificultad, function(data){
          $.each( data, function(index, value){
              $("#idEvaluacion").append($('<option>', {
                  value: value.idevaluacion,
                  text: value.tituloevaluacion
              }));
          });
          }).fail(function( data ){
              alert("Error");
        });
   }
 }
</script>
</body>
</html>