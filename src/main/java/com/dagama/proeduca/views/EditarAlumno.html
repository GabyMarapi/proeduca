<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/bootstrap-select.css" rel="stylesheet">
    <!-- font awesome for icons -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <!-- flex slider css -->
    <link href="assets/css/flexslider.css" rel="stylesheet" type="text/css" media="screen">
    <!-- animated css  -->
    <link href="assets/css/animate.css" rel="stylesheet" type="text/css" media="screen">
    <!-- Revolution Style-sheet -->
    <link href="assets/rs-plugin/css/settings.css" rel="stylesheet" type="text/css">
    <link href="assets/css/rev-style.css" rel="stylesheet" type="text/css">
    <!--owl carousel css-->
    <link href="assets/owl-carousel/dist/assets/owl.carousel.css" rel="stylesheet" type="text/css" media="screen">
    <link href="assets/owl-carousel/dist/assets/owl.theme.default.css" rel="stylesheet" type="text/css" media="screen">
    <!--mega menu -->
    <link href="assets/css/yamm.css" rel="stylesheet" type="text/css">
    <!--cube css-->
    <link href="assets/cubeportfolio/css/cubeportfolio.min.css" rel="stylesheet" type="text/css">
    <!-- custom css-->
    <link href="assets/css/components.css" rel="stylesheet" type="text/css" media="screen">
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" media="screen">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<input type="hidden" id="idAlumno">
<div id="cabeceraMenu">

</div>
<br>
<section class="container">
    <div class="form-group col-md-8">
        <div class="mb-4 pr-3 pl-3">
            <h4>Configurar Alumnos</h4>
        </div>
    </div>
</section>
<section class="container">
    <form class="needs-validation" id="my_form" novalidate>
        <section class="container">
            <div class="form-row mb-4">
                <div class="col-md-6 mb-3 pr-3 pl-3">
                    <label for="txtNombreApellidoAlumno">Nombres y Apellidos</label>
                    <input type="text" class="form-control" id="txtNombreApellidoAlumno" required="true" maxlength="64" >
                </div>
            </div>
            <div class="col-md-6 mb-3 pr-3 pl-3">
                <label for="txtDNIAlumno">DNI</label>
                <input type="text" class="form-control " id="txtDNIAlumno" required="true" maxlength="8" onkeypress='SoloNumeros(event)'>
            </div>
        </section>

        <section class="container">
            <div class="col-md-6 mb-3 pr-3 pl-3">
                <label>Nivel de Estudio</label>
                <div class="form-group">
                    <select class="form-control" id="cboNivelEstudio" required="true">
                    </select>
                </div>
            </div>
            <div class="col-md-6 mb-3 pr-3 pl-3">
                <label>Universidad</label>
                <div class="form-group">
                    <select class="form-control" id="cboUniversidad" required="true">
                    </select>
                </div>
            </div>
        </section>

        <section class="container">
            <div class="form-row">
                <div class="form-group col-md-4">

                    <button id="btnEditarAlumno" type="submit" class="btn btn-primary" style="left:500px;">Editar</button>

                </div>
            </div>
        </section>

    </form>
    <section class="container">
        <button id="btnCancelar" class="btn btn-danger" style="left:350px; bottom:62px;" onclick="window.location.href='ConfigurarAlumnos.html'">Cancelar</button>
    </section>

</section>
<div id="Footer">

</div>
<script src="assets/js/jquery.min.js "></script>
<script src="assets/js/jquery-migrate.min.js "></script>
<!--bootstrap js plugin-->
<script src="assets/js/bootstrap.min.js " type="text/javascript "></script>
<!--easing plugin for smooth scroll-->
<script src="assets/js/jquery.easing.1.3.min.js " type="text/javascript "></script>
<!--sticky header-->
<script type="text/javascript " src="assets/js/jquery.sticky.js "></script>
<!--flex slider plugin-->
<script src="assets/js/jquery.flexslider-min.js " type="text/javascript "></script>
<!--parallax background plugin-->
<script src="assets/js/jquery.stellar.min.js " type="text/javascript "></script>
<!--digit countdown plugin-->
<script src="assets/js/waypoints.min.js "></script>
<!--digit countdown plugin-->
<script src="assets/js/jquery.counterup.min.js " type="text/javascript "></script>
<!--on scroll animation-->
<script src="assets/js/wow.min.js " type="text/javascript "></script>
<!--owl carousel slider-->
<script src="assets/owl-carousel/dist/owl.carousel.min.js " type="text/javascript "></script>
<!--popup js-->
<script src="assets/js/jquery.magnific-popup.min.js " type="text/javascript "></script>
<!--customizable plugin edit according to your needs-->
<script src="assets/js/custom.js " type="text/javascript "></script>
<script type="text/javascript " src="assets/rs-plugin/js/jquery.themepunch.tools.min.js "></script>
<script type="text/javascript " src="assets/rs-plugin/js/jquery.themepunch.revolution.min.js "></script>
<script type="text/javascript " src="assets/rs-plugin/videojs/video.js "></script>
<script type="text/javascript " src="assets/js/revolution-custom.js "></script>
<script src="assets/js/bootstrap-select.min.js " type="text/javascript "></script>
<script src="assets/js/jquery-ui.min.js " type="text/javascript "></script>
<script src="assets/cubeportfolio/js/jquery.cubeportfolio.min.js " type="text/javascript "></script>
<script src="assets/js/cube-portfolio.js " type="text/javascript "></script>
<script src="assets/js/pace.min.js " type="text/javascript "></script>

<script type="text/javascript">
     $(document).ready(function () {
         $("#cabeceraMenu").load('cabeceraMenu.html');
         $("#Footer").load('Footer.html');

         Validarformulario()
         LeerDatos()

      });

       $("#txtNombreApellidoAlumno").keypress(function (key) {
            window.console.log(key.charCode)
            if ((key.charCode < 97 || key.charCode > 122)//letras mayusculas
                && (key.charCode < 65 || key.charCode > 90) //letras minusculas
                && (key.charCode != 45) //retroceso
                && (key.charCode != 241) //ñ
                 && (key.charCode != 209) //Ñ
                 && (key.charCode != 32) //espacio
                 && (key.charCode != 225) //á
                 && (key.charCode != 233) //é
                 && (key.charCode != 237) //í
                 && (key.charCode != 243) //ó
                 && (key.charCode != 250) //ú
                 && (key.charCode != 193) //Á
                 && (key.charCode != 201) //É
                 && (key.charCode != 205) //Í
                 && (key.charCode != 211) //Ó
                 && (key.charCode != 218) //Ú

                )
                return false;
        });


function Validarformulario(){
  $("#my_form").submit(function( event ){
	    var proceed = true;
	    //loop through each field and we simply change border color to red for invalid fields
        $("#my_form input[required=true], #my_form select[required=true]").each(function(){
				$(this).css('border-color','');
				if(!$.trim($(this).val())){ //if this field is empty
					$(this).css('border-color','red'); //change border color to red
				   proceed = false; //set do not proceed flag
				}
        });
        debugger;
		if(proceed){
		    var nombreAlumno = $("#txtNombreApellidoAlumno").val();
            var DNIAlumno = $("#txtDNIAlumno").val();
            var IDUniversidad = $("#cboUniversidad").val();
            var IDNivelEstudio = $("#cboNivelEstudio").val();
            var IDAlumno = $("#idAlumno").val();

            if(DNIAlumno.length < 8)
            {
               alert("Debe ingresar 08 dígitos en el DNI");
               $("#txtDNIAlumno").focus()
               return false;
            }

            var datos =
            {
                "idalumno":IDAlumno,
                "dni" : DNIAlumno,
                "nombrealumno" : nombreAlumno,
                "idnivelestudio": IDNivelEstudio,
                "iduniversidad": IDUniversidad,
                "idusuario": null
            }

            $.ajax({
                    url: "http://localhost:8080/api/alumno_reg",
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data) {
                       alert("Registro editado correctamente");
                       window.location.href="ConfigurarAlumnos.html"
                    },
                    data: JSON.stringify(datos)
                });
		}
		event.preventDefault();
	});

	$("#my_form input[required=true]").keyup(function() {
		$(this).css('border-color','');
		$("#result").slideUp();
	});

}


function  MostrarUniversidades(iduniversidad){
    $("#cboUniversidad").html('');
    $.get( "http://localhost:8080/api/universidades", function(data){
          for(var x = 0; x<data.length; x++)
          {
             var cbo = "<option value='" + data[x].iduniversidad + "'>" + data[x].nombreuniversidad + "</option>"
             $("#cboUniversidad").append(cbo)
             if(data[x].iduniversidad == iduniversidad)
             {
                 $("#cboUniversidad").val(iduniversidad);
             }
          }
     });

}

function  MostrarNivelEstudio(idnivelestudio){
    $("#cboNivelEstudio").html('');
    $.get( "http://localhost:8080/api/nivelestudios", function(data){
          for(var x = 0; x<data.length; x++)
          {
             var cbo = "<option value='" + data[x].idnivelestudio + "'>" + data[x].nombrenivelestudio + "</option>"
             $("#cboNivelEstudio").append(cbo)
             if(data[x].idnivelestudio == idnivelestudio)
             {
                 $("#cboNivelEstudio").val(idnivelestudio);
             }
          }
     });

}

function SoloNumeros(evt) {
  var theEvent = evt || window.event;

  // Handle paste
  if (theEvent.type === 'paste') {
      key = event.clipboardData.getData('text/plain');
  } else {
  // Handle key press
      var key = theEvent.keyCode || theEvent.which;
      key = String.fromCharCode(key);
  }
  var regex = /[0-9]|\./;
  if( !regex.test(key) ) {
    theEvent.returnValue = false;
    if(theEvent.preventDefault) theEvent.preventDefault();
  }
}

function LeerDatos()
{
     var IDAlumno =  localStorage.getItem("idalumno")
     $("#idAlumno").val(IDAlumno);
     ConsultarDatos(IDAlumno)
}

function ConsultarDatos(IDAlumno)
{
    $.get("http://localhost:8080/api/alumno/" + IDAlumno, function(data)
    {
           var stringifydata = "[" + JSON.stringify(data) + "]";
           var parseJson = (JSON.parse(stringifydata))

           $("#txtNombreApellidoAlumno").val(parseJson[0].nombrealumno)
           $("#txtDNIAlumno").val(parseJson[0].dni)
           MostrarUniversidades(parseJson[0].iduniversidad)
           MostrarNivelEstudio(parseJson[0].idnivelestudio)

   });
}

</script>
</body>
</html>