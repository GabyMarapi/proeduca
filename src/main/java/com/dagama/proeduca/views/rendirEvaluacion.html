<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/bootstrap-select.css" rel="stylesheet">
    <!-- font awesome for icons -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <!-- flex slider css -->
    <link href="assets/css/flexslider.css" rel="stylesheet" type="text/css" media="screen">
    <!-- animated css  -->
    <link href="assets/css/animate.css" rel="stylesheet" type="text/css" media="screen">
    <!-- Revolution Style-sheet -->
    <link href="assets/rs-plugin/css/settings.css" rel="stylesheet" type="text/css">
    <link href="assets/css/rev-style.css" rel="stylesheet" type="text/css">
    <!--owl carousel css-->
    <link href="assets/owl-carousel/dist/assets/owl.carousel.css" rel="stylesheet" type="text/css" media="screen">
    <link href="assets/owl-carousel/dist/assets/owl.theme.default.css" rel="stylesheet" type="text/css" media="screen">
    <!--mega menu -->
    <link href="assets/css/yamm.css" rel="stylesheet" type="text/css">
    <!--cube css-->
    <link href="assets/cubeportfolio/css/cubeportfolio.min.css" rel="stylesheet" type="text/css">
    <!-- custom css-->
    <link href="assets/css/components.css" rel="stylesheet" type="text/css" media="screen">
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" media="screen">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="top-bar-light">
    <div class="container">
        <div class="row">
            <div class="col-sm-4 hidden-xs">
                <div class="top-bar-socials">
                    <a href="#" class="social-icon-sm si-dark si-gray-round si-colored-facebook">
                        <i class="fa fa-facebook"></i>
                        <i class="fa fa-facebook"></i>
                    </a>
                    <a href="#" class="social-icon-sm si-dark si-gray-round si-colored-twitter">
                        <i class="fa fa-twitter"></i>
                        <i class="fa fa-twitter"></i>
                    </a>
                    <a href="#" class="social-icon-sm si-dark si-gray-round si-colored-google-plus">
                        <i class="fa fa-youtube"></i>
                        <i class="fa fa-youtube"></i>
                    </a>
                    <a href="#" class="social-icon-sm si-dark si-gray-round si-colored-instagram">
                        <i class="fa fa-instagram"></i>
                        <i class="fa fa-instagram"></i>
                    </a>
                </div>
            </div>
            <div class="col-sm-8 text-right">
                <ul class="list-inline top-dark-right">
                    <li class="hidden-sm hidden-xs"><i class="fa fa-envelope"></i> proeduca@gmail.com</li>
                    <li class="hidden-sm hidden-xs"><i class="fa fa-phone"></i> 999 999 999 </li>
                    <li><a class="topbar-icons" href="#"><span><i class="fa fa-search top-search"></i></span></a>
                    </li>
                </ul>
                <div class="search">
                    <form role="form">
                        <input type="text" class="form-control" autocomplete="off" placeholder="Buscar">
                        <span class="search-close"><i class="fa fa-times"></i></span>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="navbar navbar-default navbar-static-top yamm sticky" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="index.html">Inicio</a></li>
                <li class="  ">
                    <a href="nosotros.html">Nosotros</a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle " data-toggle="dropdown">Evaluaciones <i class="fa fa-angle-down"></i></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="RegistrarExamen.html"> Configurar Evaluación</a></li>
                        <li><a href="ConfiguracionPuntaje.html"> Configurar Evaluación Preguntas</a></li>
                        <li><a href="rendirEvaluacion.html"> Rendir evaluación</a></li>
                        <li><a href="ExamenNoProgramado.html"> Autoevaluaciones</a></li>
                    </ul>
                </li>
                <!--menu home li end here-->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle " data-toggle="dropdown">Consultas <i class="fa fa-angle-down"></i></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="reporteNotas.html"> Reporte de Notas</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <!--/.nav-collapse -->
    </div>
    <!--container-->
</div>
<br>
<section class="container">
    <br>
    <div class="container">
        <div class="form-group col-md-12">
            <h4 class="my-4">Rendir evaluación</h4>
        </div>
    </div>
</section>
<section class="container">
    <input type="hidden" id="nivelUsuario">
    <div class="form-group col-md-8">
        <section class="container">
            <div class="form-group col-md-4">
                <label for="idusuario">Alumno: </label>
                <select class="form-control" id="idusuario" required="required">
                </select>
            </div>
        </section>
        <section class="container">
            <div class="form-group col-md-4">
                <label for="idNivel">Nivel: </label>
                <select class="form-control" id="idNivel" required="required">
                </select>
            </div>
        </section>
        <section class="container">
            <div class="form-group col-md-4">
                <label for="txtFecha">Fecha: </label>
                 <input type='text' class="form-control" id="txtFecha" disabled="disabled" />
            </div>
        </section>
        <section class="container">
            <div class="form-group col-md-4">
                <label for="idEvaluacion">Evaluacion: </label>
                <select class="form-control" id="idEvaluacion" required="required">
                </select>
            </div>
        </section>
        <section class="container">
            <div class="form-row">
                <div class="form-group col-md-4">
                    <button id="btnRendirEvaluacion" class="btn btn-primary" >Rendir evaluación</button>
                </div>
            </div>
        </section>
    </div>
</section>
<!--<footer class="container-fluid ">
    <div class="row ">
        <div class="col-md-12 text-center ">
            <ul class="d-inline-block copyrigth ">
                <li>ProEduca>
                <li>©Copyright 2020</li>
            </ul>

        </div>
    </div>
</footer>-->

<script src="assets/js/jquery.min.js "></script>
<script src="assets/js/jquery-migrate.min.js "></script>
<!--bootstrap js plugin-->
<script src="assets/js/bootstrap.min.js " type="text/javascript "></script>
<!--easing plugin for smooth scroll-->
<script src="assets/js/jquery.easing.1.3.min.js " type="text/javascript "></script>
<!--sticky header-->
<script type="text/javascript " src="assets/js/jquery.sticky.js "></script>
<!--flex slider plugin-->
<script src="assets/js/jquery.flexslider-min.js " type="text/javascript "></script>
<!--parallax background plugin-->
<script src="assets/js/jquery.stellar.min.js " type="text/javascript "></script>
<!--digit countdown plugin-->
<script src="assets/js/waypoints.min.js "></script>
<!--digit countdown plugin-->
<script src="assets/js/jquery.counterup.min.js " type="text/javascript "></script>
<!--on scroll animation-->
<script src="assets/js/wow.min.js " type="text/javascript "></script>
<!--owl carousel slider-->
<script src="assets/owl-carousel/dist/owl.carousel.min.js " type="text/javascript "></script>
<!--popup js-->
<script src="assets/js/jquery.magnific-popup.min.js " type="text/javascript "></script>
<!--customizable plugin edit according to your needs-->
<script src="assets/js/custom.js " type="text/javascript "></script>
<script type="text/javascript " src="assets/rs-plugin/js/jquery.themepunch.tools.min.js "></script>
<script type="text/javascript " src="assets/rs-plugin/js/jquery.themepunch.revolution.min.js "></script>
<script type="text/javascript " src="assets/rs-plugin/videojs/video.js "></script>
<script type="text/javascript " src="assets/js/revolution-custom.js "></script>
<script src="assets/js/bootstrap-select.min.js " type="text/javascript "></script>
<script src="assets/js/jquery-ui.min.js " type="text/javascript "></script>
<script src="assets/cubeportfolio/js/jquery.cubeportfolio.min.js " type="text/javascript "></script>
<script src="assets/js/cube-portfolio.js " type="text/javascript "></script>
<script src="assets/js/pace.min.js " type="text/javascript "></script>

<script type="text/javascript">
   $(document).ready(function () {

           ObtenerFechaActual();

           $( "#idusuario" ).change(function() {
              LLenarEvaluacionPorUsuario()
              MostrarNivelUsuario($("#idusuario").val());
            });

            //llenar los alumnos en el combo
            $("#idusuario").html('');
            $.get( "http://localhost:8080/api/usuario/1", function(data){
                $.each( data, function(index, value){
                    $("#idusuario").append($('<option>', {
                        value: value.idusuario,
                        text: value.nombrealumno
                    }));
                });
                LLenarEvaluacionPorUsuario();
                MostrarNivelUsuario($("#idusuario").val());
                }).fail(function( data ){
                    alert("Error");
            });

   });

     $( "#btnRendirEvaluacion" ).click(function() {
            var ExisteEvaluacion = false;
            var fechaEvaluacion = "";
            var duracionEvaluacion = "";
            var fechaFinEvaluacion = "";

            var idevaluacionSelected = $("#idEvaluacion").val();
            var nombreNivelSelected = document.getElementById("idNivel").options[document.getElementById("idNivel").selectedIndex].text;
            var fechaSelected = $("#txtFecha").val();

            $.get( "http://localhost:8080/api/evaluacionxusuario/" + $("#idusuario").val(), function(data){

                for(var i=0; i<data.length; i++)
                {
                debugger;
                    if(data[i].idevaluacion == idevaluacionSelected && data[i].nombrenivelestudio == nombreNivelSelected
                     )
                    {
                        ExisteEvaluacion = true;
                        fechaEvaluacion = data[i].fechainicio;
                        duracionEvaluacion = data[i].duracion;
                        break;
                    }
                }

                if(ExisteEvaluacion == true)
                {
                    debugger;
                    var comboEvaluacion = $("#idEvaluacion").val();
                    var nombreComboEvaluacion = $("#idEvaluacion option:selected").text();

                    var comboNivel =  $("#idNivel").val();
                    var nombreComboNivel = $("#idNivel option:selected").text();

                    var comboUsuario =  $("#idusuario").val();
                    var nombrecomboUsuario = $("#idusuario option:selected").text();

                    localStorage.setItem("idusuario", comboUsuario);
                    localStorage.setItem("nombreUsuario", nombrecomboUsuario);

                    localStorage.setItem("idEvaluacion", comboEvaluacion);
                    localStorage.setItem("nombreEvaluacion", nombreComboEvaluacion);

                    localStorage.setItem("duracion", duracionEvaluacion);
                    localStorage.setItem("fechaEvaluacion", fechaEvaluacion);

                    localStorage.setItem("fechaFinEvaluacion", fechaFinEvaluacion);

                    localStorage.setItem("idnivel", comboNivel);
                    localStorage.setItem("nombrenivel", nombreComboNivel);

                    window.location.href = 'DetallePrevioRendirEvaluacion.html';
                }
                else
                {
                   window.location.href = 'ExamenNoProgramado.html';
                }
            });
        });

    function MostrarNivelUsuario(idusuario)
    {
       $.get( "http://localhost:8080/api/usuario/1", function(data){
            for(var i = 0; i<data.length; i++)
            {
               if(data[i].idusuario== idusuario)
               {
                  $("#nivelUsuario").val(data[i].idnivelestudio)
                  MostrarComboNivelUsuario(data[i].idnivelestudio)
               }
            }
      });
    }

    function MostrarComboNivelUsuario(idnivelEstudio)
    {
            //llenar niveles de estudio
            $("#idNivel").html('');
            $.get( "http://localhost:8080/api/nivelestudio/" + idnivelEstudio, function(data){
             var x = "[" + JSON.stringify(data) + "]";
             var z = (JSON.parse(x))
             $.each( z, function(index, value){
                    if(value.nombrenivelestudio == "5TO SECUNDARIA")
                    {
                      $.get( "http://localhost:8080/api/universidades", function(data1){
                      $.each( data1, function(index, value1){
                        if(value.iduniversidad == value1.iduniversidad)
                          {

                             $("#idNivel").append($('<option>', {
                                 value: value.idnivelestudio,
                                 text: value.nombrenivelestudio + '-' + value1.nombreuniversidad
                             }));
                          }
                        });
                      });
                    }
                    else{
                    $("#idNivel").append($('<option>', {
                        value: value.idnivelestudio,
                        text: value.nombrenivelestudio
                    }));
                    }
                });
                }).fail(function( data ){
                    alert("Error");


            });
    }

    function LLenarEvaluacionPorUsuario()
    {
        $("#idEvaluacion").html('');
        $.get( "http://localhost:8080/api/evaluacionxusuario/" + $("#idusuario").val(), function(data){
        $.each( data, function(index, value){
            $("#idEvaluacion").append($('<option>', {
                value: value.idevaluacion,
                text: value.tituloevaluacion
            }));
        });
        }).fail(function( data ){
            alert("Error");
      });
    }


    function ObtenerFechaActual()
    {
    /*
        var now = new Date();
        var month = (now.getMonth() + 1);
        var day = now.getDate();
        if (month < 10)
            month = "0" + month;
        if (day < 10)
            day = "0" + day;
        var today = day + '-' + month + '-' + now.getFullYear() ; */
        $('#txtFecha').val("22/04/2020");

    }


</script>
</body>

</html>

